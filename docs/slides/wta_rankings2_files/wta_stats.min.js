"use strict";PULSE.app.templates["stats.column-head"]=_.template("<%\n    var labelAbbr = PULSE.I18N.lookupKey( 'label.stats.' + stat + '.name.abbr' );\n    var labelFull = PULSE.I18N.lookupKey( 'label.stats.' + stat + '.name.full' );\n    var labelExplanation = PULSE.I18N.lookupKey( 'label.stats.' + stat + '.explanation' );\n    var defaultSort = defaultSort || 'desc';\n%> <th class=\"stats-list__header-cell stats-list__header-cell--sort <%= defaultSort === 'asc' ? 'stats-list__header-cell--default-asc' : '' %> <%= typeof type !== 'undefined' ? 'stats-list__column-' + type : '' %> js-sort-column <%= currentStat === stat ? currentCls : '' %>\" data-stat=\"<%= stat %>\"> <% if ( labelFull !== 'label.stats.' + stat + '.name.full' ) { %> <div class=\"stats-list__header-sort stats-list__header-sort--tooltip js-tooltip-label\"> <%= labelAbbr %> <div class=\"stats-list__description\"> <div class=\"stats-list__description-title\"><%= labelFull %></div> <% if ( labelExplanation !== 'label.stats.' + stat + '.explanation' ) { %> <p class=\"stats-list__description-text\"><%= labelExplanation %></p> <% } %> </div> </div> <% } else { %> <div class=\"stats-list__header-sort\"> <%= labelAbbr %> </div> <% } %> </th>"),PULSE.app.templates["stats.player-row"]=_.template("<% _.forEach( players, function(player) { %> <% let adRowCounter = posCount - 1; %> <% if ( typeof adUnitPath !== 'undefined' && adUnitPath && adRowCounter % 10 === 0 && adRowCounter >= 10 ) { %> <tr class=\"stats-list__ad-row\"> <td class=\"stats-list__ad-cell\" colspan=\"100\"> <% let adIndex = adRowCounter / 10; %> <%= render( {\n                    data: {\n                        adIndex: adIndex,\n                        adID: 'stats-list-advert_' + Date.now() + adIndex,\n                        cssClass: 'stats-list__advert'\n                    }\n                }, 'common.advert' ) %> </td> </tr> <% } %> <tr class=\"stats-list__row\"> <td class=\"stats-list__cell stats-list__cell--pos stats-list__cell--fixed-width <%= posCount >= 100 ? 'stats-list__cell--pos-small' : '' %>\"> <%= posCount++ %> </td> <td class=\"stats-list__cell stats-list__cell--player\"> <%= render( {\n                cssClass: 'stats-list__player-picture',\n                id: player.PlayerNbr,\n                size: 'RANKINGS',\n                styleModifier: 'closeup',\n                objectFit: true\n            }, 'common.player-headshot' ) %> <div class=\"player-name\"> <a href=\"<%= player.link %>\" class=\"player-name__container\"> <span class=\"player-name__first-name u-hide-desktop\"><%= player.First_Name %></span> <span class=\"player-name__first-name u-show-desktop\"><%= player.First_Name[ 0 ] %>.</span> <span class=\"player-name__last-name\"><%= player.Last_Name %></span> <span class=\"player-name__mask\" aria-hidden=\"true\"> <span class=\"player-name__first-name\"><%= player.First_Name %></span> <span class=\"player-name__last-name\"><%= player.Last_Name %></span> </span> </a> <div class=\"player-name__country-container\"> <%= render( {\n                        cssClass: 'player-name__flag',\n                        countryCode: player.Nationality\n                    }, 'common.flag-svg' ) %> <span class=\"player-name__country\"><%= player.Nationality %></span> </div> </div> </td> <td class=\"stats-list__cell stats-list__cell--rank stats-list__cell--fixed-width <%= currentStat === 'Current_Rank' ? 'stats-list__cell--current' : '' %>\"><%= player.Current_Rank %></td> <td class=\"stats-list__cell stats-list__cell--matches stats-list__cell--fixed-width <%= currentStat === 'MatchCount' ? 'stats-list__cell--current' : '' %>\"><%= player.MatchCount %></td> <td class=\"stats-list__cell stats-list__cell--stat stats-list__column-serve <%= currentStat === 'Aces' ? 'stats-list__cell--current' : '' %>\" data-stat=\"Aces\"><%= player.Aces %></td> <td class=\"stats-list__cell stats-list__cell--stat stats-list__column-serve <%= currentStat === 'Double_Faults' ? 'stats-list__cell--current' : '' %>\" data-stat=\"Double_Faults\"><%= player.Double_Faults %></td> <td class=\"stats-list__cell stats-list__cell--stat stats-list__column-serve <%= currentStat === 'first_serve_percent' ? 'stats-list__cell--current' : '' %>\" data-stat=\"first_serve_percent\"><%= player.first_serve_percent %> %</td> <td class=\"stats-list__cell stats-list__cell--stat stats-list__column-serve <%= currentStat === 'first_serve_won_percent' ? 'stats-list__cell--current' : '' %>\" data-stat=\"first_serve_won_percent\"><%= player.first_serve_won_percent %>%</td> <td class=\"stats-list__cell stats-list__cell--stat stats-list__column-serve <%= currentStat === 'second_serve_won_percent' ? 'stats-list__cell--current' : '' %>\" data-stat=\"second_serve_won_percent\"><%= player.second_serve_won_percent %>%</td> <td class=\"stats-list__cell stats-list__cell--stat stats-list__column-serve <%= currentStat === 'service_points_won_percent' ? 'stats-list__cell--current' : '' %>\" data-stat=\"service_points_won_percent\"><%= player.service_points_won_percent %>%</td> <td class=\"stats-list__cell stats-list__cell--stat stats-list__column-serve <%= currentStat === 'breakpoint_saved_percent' ? 'stats-list__cell--current' : '' %>\" data-stat=\"breakpoint_saved_percent\"><%= player.breakpoint_saved_percent %>%</td> <td class=\"stats-list__cell stats-list__cell--stat stats-list__column-serve <%= currentStat === 'service_games_won_percent' ? 'stats-list__cell--current' : '' %>\" data-stat=\"service_games_won_percent\"><%= player.service_games_won_percent %>%</td> <td class=\"stats-list__cell stats-list__cell--stat stats-list__column-return <%= currentStat === 'first_return_percent' ? 'stats-list__cell--current' : '' %>\" data-stat=\"first_return_percent\"><%= player.first_return_percent %>%</td> <td class=\"stats-list__cell stats-list__cell--stat stats-list__column-return <%= currentStat === 'second_return_percent' ? 'stats-list__cell--current' : '' %>\" data-stat=\"second_return_percent\"><%= player.second_return_percent %>%</td> <td class=\"stats-list__cell stats-list__cell--stat stats-list__column-return <%= currentStat === 'return_games_won_percent' ? 'stats-list__cell--current' : '' %>\" data-stat=\"return_games_won_percent\"><%= player.return_games_won_percent %>%</td> <td class=\"stats-list__cell stats-list__cell--stat stats-list__column-return <%= currentStat === 'breakpoint_converted_percent' ? 'stats-list__cell--current' : '' %>\" data-stat=\"breakpoint_converted_percent\"><%= player.breakpoint_converted_percent %>%</td> <td class=\"stats-list__cell stats-list__cell--stat stats-list__column-return <%= currentStat === 'return_points_won_percent' ? 'stats-list__cell--current' : '' %>\" data-stat=\"return_points_won_percent\"><%= player.return_points_won_percent %>%</td> </tr> <% } ) %>"),PULSE.app.templates["stats.table"]=_.template("<table class=\"stats-list__table\"> <thead class=\"stats-list__table-head js-table-head\"> <th class=\"stats-list__header-cell stats-list__header-cell--pos\"><%= PULSE.I18N.lookupKey( 'label.stats.pos' ) %></th> <th class=\"stats-list__header-cell stats-list__header-cell--player\"><%= PULSE.I18N.lookupKey( 'label.rankings.player' ) %></th> <%= render( { currentStat: currentStat, currentCls: currentCls, stat: 'Current_Rank', defaultSort: 'asc' }, 'stats.column-head' ) %> <%= render( { currentStat: currentStat, currentCls: currentCls, stat: 'MatchCount' }, 'stats.column-head' ) %> <%= render( { currentStat: currentStat, currentCls: currentCls, stat: 'Aces', type: 'serve' }, 'stats.column-head' ) %> <%= render( { currentStat: currentStat, currentCls: currentCls, stat: 'Double_Faults', type: 'serve' }, 'stats.column-head' ) %> <%= render( { currentStat: currentStat, currentCls: currentCls, stat: 'first_serve_percent', type: 'serve' }, 'stats.column-head' ) %> <%= render( { currentStat: currentStat, currentCls: currentCls, stat: 'first_serve_won_percent', type: 'serve' }, 'stats.column-head' ) %> <%= render( { currentStat: currentStat, currentCls: currentCls, stat: 'second_serve_won_percent', type: 'serve' }, 'stats.column-head' ) %> <%= render( { currentStat: currentStat, currentCls: currentCls, stat: 'service_points_won_percent', type: 'serve' }, 'stats.column-head' ) %> <%= render( { currentStat: currentStat, currentCls: currentCls, stat: 'breakpoint_saved_percent', type: 'serve' }, 'stats.column-head' ) %> <%= render( { currentStat: currentStat, currentCls: currentCls, stat: 'service_games_won_percent', type: 'serve' }, 'stats.column-head' ) %> <%= render( { currentStat: currentStat, currentCls: currentCls, stat: 'first_return_percent', type: 'return' }, 'stats.column-head' ) %> <%= render( { currentStat: currentStat, currentCls: currentCls, stat: 'second_return_percent', type: 'return' }, 'stats.column-head' ) %> <%= render( { currentStat: currentStat, currentCls: currentCls, stat: 'return_games_won_percent', type: 'return' }, 'stats.column-head' ) %> <%= render( { currentStat: currentStat, currentCls: currentCls, stat: 'breakpoint_converted_percent', type: 'return' }, 'stats.column-head' ) %> <%= render( { currentStat: currentStat, currentCls: currentCls, stat: 'return_points_won_percent', type: 'return' }, 'stats.column-head' ) %> </thead> <tbody class=\"stats-list__table-body js-table-body\"> <%= render( { players: players, posCount: posCount, currentStat: currentStat, adUnitPath: adUnitPath }, 'stats.player-row' ) %> </tbody> </table>"),function(t,s,a){t.StatsDataService=function(t){var e=this,s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};this.container=t,this.render=s.render||function(){},this.dataParams=r(s),this.makeRequest(function(t){return e.render(t,!0,!0)})},t.StatsDataService.prototype.makeRequest=function(t){this.loading=!0;var e=a.url.getStatsURL(this.dataParams);s.data.request(e,"GET",t,this)},t.StatsDataService.prototype.load=function(t){var e=this;this.loading||(null!==t.page&&(this.dataParams.params.page=t.page),null!==t.type&&(this.dataParams.type=t.type),null!==t.sort&&(this.dataParams.params.sort=t.sort),this.makeRequest(function(t){return e.render(t,!0,!0)}))},t.StatsDataService.prototype.loadMore=function(){var e=this;this.loading||(this.dataParams.params.page++,this.makeRequest(function(t){return e.render(t,!1)}))};var r=function(t){return{type:t.type||"Aces",year:t.year||moment().format("YYYY"),params:{page:t.page||0,pageSize:t.pageSize||20,sort:t.sort||"asc"}}}}(PULSE.app,PULSE.core,PULSE.app.common),function(n,r,i,c){var o=[500,404],d="stats-list--loading";n.StatsList=function(t){this.container=t,this.statsContent=t.querySelector(".js-content"),this.loader=t.querySelector(".js-loader-new"),this.loaderMore=t.querySelector(".js-loader"),this.showMoreButton=t.querySelector(".js-show-more-button"),this.errorContainer=t.querySelector(".js-stats-error"),this.serveStatsToggle=t.querySelector(".js-serve-stats"),this.returnStatsToggle=t.querySelector(".js-return-stats"),this.mobileNav=document.querySelector(".js-mobile-main-nav-bar"),this.customFilters=[].slice.call(t.querySelectorAll(".js-custom-filter")),this.statsYear=t.dataset.year,this.statsType="serve",this.statsMetric="Current_Rank",this.sortDirection="asc",this.posCount=1,this.dataService=new n.StatsDataService(t,e.call(this)),this.adUnitPath=this.container.dataset.adUnitPath,this.init()},n.StatsList.prototype.init=function(){var e=this,t=new Promise(S),s=void 0;i.style.addClass(document.body,"u-no-overflow"),t.then(function(){(s=function(t,e){n.InfiniteScrollWidget.call(this,t,e)}).prototype=Object.create(n.InfiniteScrollWidget.prototype),s.prototype.makeRequest=h.bind(e),s.prototype.constructor=s}),r.addAriaClickListener(this.showMoreButton,function(){e.infiniteScroll?e.infiniteScroll.start():e.infiniteScroll=new s(e.container,e.render)}),r.addAriaClickListener(this.serveStatsToggle,l.bind(this,"serve")),r.addAriaClickListener(this.returnStatsToggle,l.bind(this,"return")),this.customFilters.forEach(function(t){return r.addAriaClickListener(t,function(t){return a.call(e,t)})})},n.StatsList.prototype.render=function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],s=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(i.style.removeClass(this.container,d),this.dataService.loading=!1,t&&!_.contains(o,t.fullXhttpResponse.status)){if(0===t.length)return this.infiniteScroll&&this.infiniteScroll.stop(),void i.style.addClass(this.loaderMore,c.U_HIDE);var a=p(t);if(e){var r="stats-list__header-cell--current stats-list__header-cell--"+this.sortDirection,l={players:a,posCount:this.posCount,currentStat:this.statsMetric,currentCls:r,adUnitPath:this.adUnitPath};this.statsContent.innerHTML=n.templating.render(l,"stats.table"),u.call(this)}else{this.statsContent.querySelector(".js-table-body").insertAdjacentHTML("beforeend",n.templating.render({players:a,posCount:this.posCount,currentStat:this.statsMetric,adUnitPath:this.adUnitPath},"stats.player-row"))}this.posCount+=t.length,this.tableHead=this.statsContent.querySelector(".js-table-head"),n.widgetInitialiser.addMultipleWidgetsByName("player-headshot",n.PlayerHeadshot,this.statsContent),s&&i.style.removeClass(this.showMoreButton,c.U_HIDE),i.style.addClass(this.loader,c.U_HIDE),i.style.addClass(this.errorContainer,c.U_HIDE),0<this.adUnitPath.length&&this.setupAds()}else 0===this.currentPage?y.call(this):(this.infiniteScroll&&this.infiniteScroll.stop(),i.style.addClass(this.loaderMore,c.U_HIDE))},n.StatsList.prototype.setupAds=function(){var a=this,t=this.container.querySelectorAll(".js-advert");[].forEach.call(t,function(t){if("true"!==t.getAttribute("data-activated")){var e=t.dataset.index,s={adID:t.dataset.id,adUnitPath:a.adUnitPath+"_"+e,size:"responsive"};r.setupAd(s),t.setAttribute("data-activated",!0)}})};var u=function(){var e=this;[].slice.call(this.statsContent.querySelectorAll(".js-sort-column")).forEach(function(t){r.addAriaClickListener(t,function(t){return s.call(e,t.currentTarget.dataset.stat)})}),[].slice.call(this.statsContent.querySelectorAll(".js-tooltip-label")).forEach(function(t){t.addEventListener("mouseenter",function(t){e.tooltipTimer=setTimeout(function(){i.style.addClass(t.target,"stats-list__header-sort--tooltip-open")},300)}),t.addEventListener("mouseleave",function(t){i.style.removeClass(t.target,"stats-list__header-sort--tooltip-open"),clearTimeout(e.tooltipTimer)})})},s=function(t){t!==this.statsMetric?this.sortDirection="Current_Rank"===t?"asc":"desc":this.sortDirection="desc"===this.sortDirection?"asc":"desc",this.statsMetric=t,this.posCount=1,this.infiniteScroll&&this.infiniteScroll.stop(),i.style.addClass(this.errorContainer,c.U_HIDE),i.style.addClass(this.showMoreButton,c.U_HIDE),i.style.addClass(this.loaderMore,c.U_HIDE),i.style.addClass(this.container,d),i.style.removeClass(this.loader,c.U_HIDE),this.dataService.load({type:this.statsMetric,sort:this.sortDirection,page:0})},a=function(t){i.style.toggleClass(t.currentTarget,"stats-list__custom-filter--checked"),i.style.toggleClass(this.statsContent,"stats-list__table-container--"+t.currentTarget.dataset.stat)},l=function(t){t!==this.statsType&&("serve"===(this.statsType=t)?(i.style.removeClass(this.returnStatsToggle,c.ACTIVE_CLASS),i.style.removeClass(this.container,"stats-list--returns"),i.style.addClass(this.serveStatsToggle,c.ACTIVE_CLASS)):(i.style.removeClass(this.serveStatsToggle,c.ACTIVE_CLASS),i.style.addClass(this.returnStatsToggle,c.ACTIVE_CLASS),i.style.addClass(this.container,"stats-list--returns")))},p=function(t){return t.map(function(t){return t.id=t.PlayerNbr,t.fullName=t.First_Name+" "+t.Last_Name,t.type="tennis_player",t.link=r.url.generateUrl(t),t})},e=function(){return{render:this.render.bind(this),page:0,type:this.statsMetric,sort:this.sortDirection,year:this.statsYear}},h=function(){this.dataService.loadMore()},y=function(){this.dataService.loading=!1,i.style.addClass(this.loader,c.U_HIDE),i.style.addClass(this.loaderMore,c.U_HIDE),i.style.removeClass(this.errorContainer,c.U_HIDE)},S=function(t){void 0!==n.InfiniteScrollWidget?t():document.addEventListener(r.CONSTANTS.InfiniteScrollWidget.READY,t)};n.widgetInitialiser.addMultipleWidgetsByName("stats-list",n.StatsList)}(PULSE.app,PULSE.app.common,PULSE.core,PULSE.app.common.CONSTANTS);